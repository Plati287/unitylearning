using UnityEngine;
using UnityEngine.UI;

public class GameManager : MonoBehaviour
{
    void Awake()
    {
        // Agregar los componentes necesarios
        gameObject.AddComponent<ContadorCalabazas>();
        gameObject.AddComponent<UIManager>();
    }
}

// CONTADOR DE CALABAZAS
public class ContadorCalabazas : MonoBehaviour
{
    public static ContadorCalabazas Instance;

    private int calabazas = 0;
    private int total = 5;

    void Awake()
    {
        Instance = this;
        Debug.Log("Contador iniciado");
    }

    public void Sumar()
    {
        calabazas++;
        UIManager.Instance.ActualizarContador(calabazas, total);
        Debug.Log($"Calabazas: {calabazas}/{total}");
    }
}

// INTERFAZ GRÁFICA
public class UIManager : MonoBehaviour
{
    public static UIManager Instance;

    private Text textoE;
    private Text textoContador;

    void Awake()
    {
        Instance = this;
        Debug.Log("UIManager iniciado");
    }

    void Start()
    {
        CrearUI();
        Debug.Log("UI creada");
    }

    void CrearUI()
    {
        // CANVAS
        GameObject canvas = new GameObject("Canvas");
        Canvas c = canvas.AddComponent<Canvas>();
        c.renderMode = RenderMode.ScreenSpaceOverlay;
        canvas.AddComponent<CanvasScaler>();
        canvas.AddComponent<GraphicRaycaster>();

        // TEXTO E (centro)
        GameObject objE = new GameObject("TextoE");
        objE.transform.SetParent(canvas.transform, false);
        textoE = objE.AddComponent<Text>();
        textoE.text = "[ E ]";
        textoE.font = Resources.GetBuiltinResource<Font>("LegacyRuntime.ttf");
        textoE.fontSize = 50;
        textoE.alignment = TextAnchor.MiddleCenter;
        textoE.color = Color.white;

        RectTransform rtE = objE.GetComponent<RectTransform>();
        rtE.anchorMin = new Vector2(0.5f, 0.5f);
        rtE.anchorMax = new Vector2(0.5f, 0.5f);
        rtE.anchoredPosition = new Vector2(0, -100); // Ajustar la posición vertical
        rtE.sizeDelta = new Vector2(200, 80);

        // CONTADOR (arriba centrado)
        GameObject objContador = new GameObject("TextoContador");
        objContador.transform.SetParent(canvas.transform, false);
        textoContador = objContador.AddComponent<Text>();
        textoContador.text = "Calabazas: 0/5";
        textoContador.font = Resources.GetBuiltinResource<Font>("LegacyRuntime.ttf");
        textoContador.fontSize = 30;
        textoContador.alignment = TextAnchor.UpperCenter;  // Cambié esto para que esté centrado en la parte superior
        textoContador.color = Color.blue;

        RectTransform rtC = objContador.GetComponent<RectTransform>();
        rtC.anchorMin = new Vector2(0.5f, 1);  // Centrado horizontal
        rtC.anchorMax = new Vector2(0.5f, 1);  // Centrado horizontal
        rtC.anchoredPosition = new Vector2(0, -20);  // Ajusté la posición vertical para que esté cerca de la parte superior
        rtC.sizeDelta = new Vector2(300, 50);  // Tamaño del texto

        MostrarE(false);
    }

    public void MostrarE(bool mostrar)
    {
        if (textoE != null)
            textoE.gameObject.SetActive(mostrar);
    }

    public void ActualizarContador(int actual, int total)
    {
        if (textoContador != null)
            textoContador.text = $"Calabazas: {actual}/{total}";
    }
}
